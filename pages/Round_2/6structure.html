<h2 class="contentCenter mainText">Стуктура скетча</h2>
<p>
    В предыдущем разделе мы говорили о языке программирования, 
    который используется в Arduino. Этот язык очень похож на язык Си, 
    но есть и некоторые отличия. 
    Во-первых, когда пишут программу для Arduino, она обязательно 
    должна быть написана в одном файле, который называют скетч. Вы 
    можете часто встретить такое сочетание слов «скетч для Arduino», это 
    значит программа для Arduino.
    Есть отличие в структуре скетча от структуры обычной 
    программы на Си, и вызвано оно различием между работой 
    программы на обычном компьютере и во всторенных системах. Когда 
    выполняют программу на обычном компьютере, то она запускается, 
    выполняет какие-то действия, а потом завершается. Если программу 
    пишут на языке Си, то за ее выполнение отвечает функция main(). 
    3.5 Структура скетча 67
    При запуске программы запускается именно эта функция. Из нее
    программист уже может вызвать остальные функции программы 
    в том порядке, в котором они должны выполняться. Когда функция 
    main() возвращает управление с помощью return, программа завершается.
    Но для программы, управляющей микроконтроллером, такое 
    поведение не имеет смысла. Пока на устройство подано питание, 
    микроконтроллер должен управлять устройством, а значит, он 
    должен выполнять свою программу. Эта программа никогда не 
    завершается сама, она перестает работать, только если выключить 
    микроконтроллер. 
    Поэтому структура программы для Arduino отличается от 
    структуры обычной программы на языке Си. В программе для 
    Arduino не должно быть функции main(), вместо нее должны быть 
    две функции: setup() и loop().
    Первая из этих функций, функция setup(), вызывается один раз 
    в самом начале выполнения программы сразу после того, как 
    микроконтроллер включили. Она должна подготовить микроконтроллер и все устройства к работе. 
    Обычно в этой функции настраивают микроконтроллер, например, задают, какие его выводы будут использоваться как входы, 
    а какие – как выходы и так далее. В этой функции можно вывести на 
    экран приветствие для пользователя (если у устройства есть экран). 
    Или каким-то другим образом приготовить устройство к работе. 
    Может быть, нужно что-то включить, или наоборот, убедиться, что 
    ничего лишнего пока не включено.
    Вторая функция, функция loop(), выполняется все время, пока 
    работает наше устройство. Если она завершится, то среда Arduino
    запустит ее заново. В этой функции как раз и нужно реализовать 
    алгоритм работы устройства. Обычно в ней опрашивают подключенные к микроконтроллеру сенсоры, или сами входы микроконтроллера, анализируют полученную информацию и выдают команды 
    исполнительным устройствам.
    Можно считать, что где-то в библиотеке Arduino уже есть функция 
    main(), которая устроена примерно так:
    void main() {
    setup();
    68 3. Arduino
    while(true)
    loop();
    }
    Такая функция там действительно есть, скорее всего она устроена 
    более сложно, она может делать еще какие-то действия по управлению микроконтроллером, но общая структура именно такова. А нам 
    нужно написать две функции setup() и loop().
    Как и в обычных программах, мы можем создавать и любые 
    другие свои функции и вызывать их из setup() и loop(). Если вы 
    делаете что-то простое, то можно написать весь код просто внутри 
    setup() и loop(). Так стоит сделать, если весь их код помещается 
    в несколько строчек. Если делать что-то сложное, то стоит разбить 
    код на отдельные функции.
    В программе Arduino можно вызывать стандартные функции, 
    которые есть в библиотеке. Для этого не нужно добавлять директив 
    #include. В обычном языке Си это нужно делать даже для 
    стандартных функций. Одна из таковых, которая будет часто использоваться, это функция delay( время ), делающая задержку на 
    указанное время. Время задается в миллисекундах, поэтому, чтобы 
    подождать 1 секунду, надо написать:
    delay(1000);
    Есть еще несколько стандартных функций, которые мы будем 
    использовать, и которые можно сразу писать в программе. Эти 
    функции управляют базовыми возможностями микроконтроллера, и 
    мы их рассмотрим, когда они нам понадобятся.
    Большим преимуществом среды Arduino является ее большая 
    популярность. Многие производители выпускают платы 
    расширения, которые можно подключать к Arduino и использовать 
    вместе с ней. Для того чтобы такие платы было удобно использовать, 
    для них пишут библиотеки, содержащие удобные функции для 
    работы с этими устройствами. Пишут такие библиотеки и просто для 
    отдельных компонентов, которые можно подключить к плате 
    Arduino. Мы будем использовать, например, библиотеку для 
    управления жидкокристаллическим экраном.
    Чтобы использовать библиотеку, нужно в начале программы 
    поместить директиву #include:
    3.5 Структура скетча 69
    #include < имя_библиотеки.h >
    Например, библиотека для работы с дисплеем называется 
    LiquidCrystall, и чтобы ее использовать, надо сначала написать
    #include <LiquidCrystal.h>
    В языке Arduino для работы с библиотеками используют 
    элементы языка С++. Фактически, сами библиотеки пишут на С++, 
    но в скетче можно использовать только очень простые возможности 
    этого языка. Язык C++ позволяет создавать классы. Классы – это 
    пользовательские типы данных, описывающие набор полей
    и операции, которые с ними можно делать. С помощью этого 
    механизма в C++ можно сделать, например, класс «дисплей» 
    и переменную такого типа. Такие переменные называют объектами. 
    Потом можно работать с этими «сложными» переменными. Чтобы 
    сделать такую переменную, ее надо объявить, как объявляют 
    обычные переменные. Например, для работы с дисплеем надо 
    сделать переменную типа LiquidCrystall:
    LiquidCrystal lcd(4, 5, 6, 7, 8, 9);
    Тут LiquidCrystall – это название типа, его пишут в документации 
    на библиотеку. lcd – это название нашей переменной, можно 
    использовать любое имя, как удобно. Цифры – это параметры, 
    которые передаются объекту при создании. О том, какие параметры 
    надо указать, тоже пишут в документации. Для дисплея это, на самом 
    деле, номера выводов микроконтроллера, к которым он подключен. 
    Позже мы рассмотрим работу с дисплеями более подробно.
    После того, как переменная создана, мы можем с ней работать. 
    Для этого используют специальные функции, которые доступны 
    только для этой переменной. Такие функции еще называют 
    «методами класса». Вызывают их следующим способом:
    имя_переменной.имя_функции( параметры );
    Например, текст на дисплей выводит функция print, и ее можно 
    вызвать следующим образом:
    lcd.print("Hello!");
    Так как мы указываем сначала имя переменной, то функция print
    вызывается именно для этой переменной. Можно подключить 
    несколько дисплеев и сделать для каждого из них свою переменную
</p>